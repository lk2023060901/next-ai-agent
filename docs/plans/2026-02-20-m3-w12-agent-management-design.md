# M3 W12 Agent ç®¡ç†æ¨¡å—è®¾è®¡æ–‡æ¡£

**æ—¥æœŸ**: 2026-02-20
**é‡Œç¨‹ç¢‘**: M3 Week 12
**èŒƒå›´**: å…¨éƒ¨ 9 ä¸ªä»»åŠ¡ï¼ˆ12.1â€“12.9ï¼‰

---

## ä¸€ã€èƒŒæ™¯ä¸ç›®æ ‡

å®ç°å·¥ä½œåŒº Agent çš„å®Œæ•´ CRUD ç®¡ç†ç•Œé¢ï¼ŒåŒ…æ‹¬åˆ—è¡¨å±•ç¤ºã€4 æ­¥åˆ›å»ºå‘å¯¼ã€é…ç½®æŠ½å±‰ã€æç¤ºè¯ç¼–è¾‘å™¨ã€å·¥å…·é€‰æ‹©å™¨ã€å·¥å…·æˆæƒçŸ©é˜µå’Œå·¥å…·æ³¨å†Œè¡¨é¡µé¢ã€‚

---

## äºŒã€æ¶æ„æ–¹æ¡ˆ

**é€‰å®šæ–¹æ¡ˆ**ï¼šåˆ—è¡¨é¡µ + å¼¹çª—å‘å¯¼ + ä¾§è¾¹æŠ½å±‰

- `agents/page.tsx`ï¼šå¡ç‰‡ç½‘æ ¼åˆ—è¡¨ï¼Œé¡¶éƒ¨æœç´¢/çŠ¶æ€ç­›é€‰
- ç‚¹å‡»ã€Œåˆ›å»º Agentã€â†’ Modal å†…è¿è¡Œ 4 æ­¥å‘å¯¼
- ç‚¹å‡» Agent å¡ç‰‡ â†’ å³ä¾§æ»‘å…¥ 520px é…ç½®æŠ½å±‰ï¼ˆTab åˆ‡æ¢ï¼‰
- `agents/tools/page.tsx`ï¼šå·¥å…·æ³¨å†Œè¡¨ç‹¬ç«‹é¡µé¢

---

## ä¸‰ã€æ–‡ä»¶ç»“æ„

```
app/(dashboard)/org/[slug]/ws/[wsSlug]/
â””â”€â”€ agents/
    â”œâ”€â”€ page.tsx                        # 12.1 Agent åˆ—è¡¨é¡µ
    â””â”€â”€ tools/
        â””â”€â”€ page.tsx                    # 12.9 å·¥å…·æ³¨å†Œè¡¨é¡µ

components/features/agent/
â”œâ”€â”€ agent-card.tsx                      # 12.2 Agent å¡ç‰‡
â”œâ”€â”€ agent-create-wizard.tsx             # 12.3 4æ­¥åˆ›å»ºå‘å¯¼
â”œâ”€â”€ agent-config-drawer.tsx             # 12.4 é…ç½®æŠ½å±‰
â”œâ”€â”€ prompt-editor.tsx                   # 12.5 æç¤ºè¯ç¼–è¾‘å™¨
â”œâ”€â”€ tool-selector.tsx                   # 12.6 å·¥å…·é€‰æ‹©å™¨
â””â”€â”€ tool-auth-matrix.tsx                # 12.8 æˆæƒçŸ©é˜µ

hooks/
â””â”€â”€ use-agents.ts                       # 12.7 React Query CRUD Hooks

mocks/handlers/
â””â”€â”€ agents.ts                           # å·²æœ‰ï¼Œè¡¥å…… Tool ç›¸å…³ç«¯ç‚¹

types/
â””â”€â”€ api.ts                              # æ‰©å±• Agent ç±»å‹ï¼Œæ–°å¢ Tool ç±»å‹
```

---

## å››ã€æ•°æ®æ¨¡å‹

### Agent ç±»å‹æ‰©å±•

```typescript
// åœ¨ç°æœ‰å­—æ®µåŸºç¡€ä¸Šæ–°å¢
interface Agent {
  // ç°æœ‰: id, name, role, status, model, systemPrompt, tools, workspaceId, createdAt, updatedAt
  avatar?: string           // emoji å­—ç¬¦ï¼Œå¦‚ "ğŸ¤–"
  knowledgeBases?: string[] // çŸ¥è¯†åº“ ID åˆ—è¡¨
  description?: string      // ç®€çŸ­æè¿°ï¼ˆå¡ç‰‡å±•ç¤ºç”¨ï¼‰
}
```

### Tool ç±»å‹ï¼ˆæ–°å¢ï¼‰

```typescript
interface Tool {
  id: string
  name: string
  category: string          // å·¥å…·åˆ†ç±»ï¼šfile / network / code / system / database ç­‰
  description: string
  riskLevel: 'low' | 'medium' | 'high'
  platform: 'local' | 'cloud' | 'both'
  requiresApproval: boolean
}
```

### åˆ›å»ºå‘å¯¼è¡¨å•çŠ¶æ€

```typescript
interface AgentDraft {
  step1: { role: AgentRole; avatar: string; name: string; description?: string }
  step2: { model: string; temperature?: number }
  step3: { systemPrompt: string; knowledgeBases: string[] }
  step4: { tools: string[] }
}
```

### KnowledgeBase ç±»å‹ï¼ˆæ–°å¢ï¼‰

```typescript
interface KnowledgeBase {
  id: string
  name: string
  workspaceId: string
}
```

---

## äº”ã€API Hooksï¼ˆuse-agents.tsï¼‰

```typescript
// æŸ¥è¯¢
useAgents(workspaceId, filters?: { status?: AgentStatus; search?: string })
useAgent(id)

// å˜æ›´
useCreateAgent()   // POST /api/workspaces/:wsId/agents
useUpdateAgent()   // PATCH /api/agents/:id
useDeleteAgent()   // DELETE /api/agents/:id
```

---

## å…­ã€ç»„ä»¶è®¾è®¡

### 12.1 Agent åˆ—è¡¨é¡µ

- é¡¶éƒ¨ï¼šæ ‡é¢˜ + ã€Œåˆ›å»º Agentã€æŒ‰é’®ï¼ˆå³å¯¹é½ï¼‰
- è¿‡æ»¤æ ï¼šæœç´¢è¾“å…¥æ¡† + çŠ¶æ€ Tabsï¼ˆå…¨éƒ¨ / è¿è¡Œä¸­ / ç©ºé—² / é”™è¯¯ï¼‰
- ä¸»ä½“ï¼šå“åº”å¼ç½‘æ ¼ `grid-cols-1 md:grid-cols-2 xl:grid-cols-3`ï¼Œé—´è· gap-4
- ç©ºçŠ¶æ€ï¼šEmptyState ç»„ä»¶ + ã€Œåˆ›å»ºç¬¬ä¸€ä¸ª Agentã€å¼•å¯¼æŒ‰é’®
- åŠ è½½æ€ï¼šéª¨æ¶å±ï¼ˆ3 ä¸ª skeleton å¡ç‰‡ï¼‰

### 12.2 Agent å¡ç‰‡ï¼ˆagent-card.tsxï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–ˆâ–ˆâ–ˆ è§’è‰²è‰²å¸¦ï¼ˆ4px é«˜ï¼‰           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ¤– å‰ç«¯å·¥ç¨‹å¸ˆ          [è¿è¡Œä¸­] â”‚
â”‚    frontend                     â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ claude-sonnet-4-6    å·¥å…·:5 çŸ¥:2â”‚
â”‚                       â‹¯ æ“ä½œèœå•â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- è§’è‰²è‰²å¸¦ï¼šé¡¶éƒ¨ 4px è‰²æ¡ï¼Œä½¿ç”¨ `var(--color-agent-{role})`
- çŠ¶æ€å¾½ç« ï¼šidle=ç° / running=ç»¿ï¼ˆå¸¦åŠ¨ç”»è„‰å†²ç‚¹ï¼‰/ error=çº¢
- æ“ä½œèœå•ï¼ˆä¸‹æ‹‰ï¼‰ï¼šç¼–è¾‘é…ç½® / åˆ é™¤

### 12.3 4æ­¥åˆ›å»ºå‘å¯¼ï¼ˆagent-create-wizard.tsxï¼‰

å¼¹çª—å°ºå¯¸ï¼š`max-w-2xl`ï¼Œæ­¥éª¤è¿›åº¦æ¡åœ¨é¡¶éƒ¨ã€‚

**æ­¥éª¤ 1ï¼šèº«ä»½**
- 8ä¸ªè§’è‰²å¡ç‰‡ç½‘æ ¼ï¼ˆ2x4ï¼‰ï¼Œç‚¹å‡»é€‰ä¸­é«˜äº®ï¼ˆè§’è‰²è‰²è¾¹æ¡†ï¼‰
- é€‰ä¸­è§’è‰²åï¼šEmoji é€‰æ‹©æŒ‰é’®ï¼ˆå¼¹å‡º emoji pickerï¼‰+ åç§°è¾“å…¥æ¡† + æè¿°ï¼ˆå¯é€‰ï¼‰

**æ­¥éª¤ 2ï¼šæ¨¡å‹**
- æ¨¡å‹é€‰æ‹©ï¼šä¸‹æ‹‰é€‰å•ï¼ˆclaude-sonnet-4-6 / claude-opus-4-6 / claude-haiku-4-5 ç­‰ï¼‰
- Temperature æ»‘å—ï¼š0.0â€“1.0ï¼Œæ­¥è¿› 0.1ï¼Œå¯é€‰

**æ­¥éª¤ 3ï¼šæç¤ºè¯**
- PromptEditor ç»„ä»¶ï¼ˆè§ 12.5ï¼‰
- çŸ¥è¯†åº“å¤šé€‰ä¸‹æ‹‰ï¼ˆå¸¦æœç´¢ï¼‰

**æ­¥éª¤ 4ï¼šå·¥å…·**
- ToolSelector ç»„ä»¶ï¼ˆè§ 12.6ï¼‰
- åº•éƒ¨ï¼šã€Œåˆ›å»º Agentã€æŒ‰é’®ï¼ˆloading æ€ï¼‰

åº•éƒ¨å¯¼èˆªï¼šä¸Šä¸€æ­¥ï¼ˆghost æŒ‰é’®ï¼‰/ ä¸‹ä¸€æ­¥ æˆ– åˆ›å»ºï¼ˆprimary æŒ‰é’®ï¼‰

### 12.4 é…ç½®æŠ½å±‰ï¼ˆagent-config-drawer.tsxï¼‰

- å®½åº¦ï¼š520pxï¼Œä»å³ä¾§æ»‘å…¥
- Headerï¼šAgent åç§° + Emoji + å…³é—­æŒ‰é’®
- 4 ä¸ª Tabï¼š
  - **åŸºæœ¬ä¿¡æ¯**ï¼šåç§°ã€è§’è‰²ã€æ¨¡å‹ã€æè¿°
  - **æç¤ºè¯**ï¼šPromptEditor + çŸ¥è¯†åº“é€‰æ‹©
  - **å·¥å…·**ï¼šToolSelector
  - **é«˜çº§**ï¼štemperatureã€å…¶ä»–æœªæ¥é…ç½®é¡¹
- Footerï¼šå–æ¶ˆ / ä¿å­˜ æŒ‰é’®

### 12.5 æç¤ºè¯ç¼–è¾‘å™¨ï¼ˆprompt-editor.tsxï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ [âš¡] â”
â”‚ textarea                            â”‚
â”‚                                     â”‚
â”‚                                     â”‚
â”‚                          Tokens: 0  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- é«˜åº¦ï¼šmin 200pxï¼Œè‡ªåŠ¨æ‰©å±•
- Token è®¡æ•°ï¼š`Math.ceil(text.length / 4)`ï¼Œå®æ—¶æ›´æ–°
- âš¡ æŒ‰é’®ï¼šå¼¹å‡ºæ¨¡æ¿é¢æ¿ï¼ˆæŒ‰è§’è‰²åˆ†ç±»çš„é¢„è®¾æç¤ºè¯æ¨¡æ¿ï¼‰
- æ”¯æŒ Markdown è¯­æ³•ï¼ˆçº¯æ–‡æœ¬ç¼–è¾‘ï¼Œé¢„ç•™ preview åˆ‡æ¢æ¥å£ï¼‰

### 12.6 å·¥å…·é€‰æ‹©å™¨ï¼ˆtool-selector.tsxï¼‰

- é¡¶éƒ¨ï¼šæœç´¢æ¡† + åˆ†ç±»ç­›é€‰ Tabs
- å·¥å…·åˆ—è¡¨ï¼šæ¯é¡¹æ˜¾ç¤ºåç§° + æè¿° + é£é™©ç­‰çº§å¾½ç« ï¼ˆä½=ç»¿/ä¸­=æ©™/é«˜=çº¢ï¼‰+ å¹³å°å›¾æ ‡ï¼ˆæœ¬åœ°/äº‘ç«¯ï¼‰
- å‹¾é€‰æ¡†å¤šé€‰ï¼Œå³ä¾§å±•ç¤ºå·²é€‰æ•°é‡
- æŒ‰åˆ†ç±»æŠ˜å /å±•å¼€

### 12.7 CRUD Hooksï¼ˆuse-agents.tsï¼‰

ä½¿ç”¨ TanStack Queryï¼Œkey çº¦å®šï¼š
- `['agents', workspaceId]`
- `['agent', id]`

ä¹è§‚æ›´æ–°ï¼šåˆ é™¤æ—¶ç«‹å³ä»åˆ—è¡¨ç§»é™¤ï¼Œå¤±è´¥æ—¶å›æ»šã€‚

### 12.8 å·¥å…·æˆæƒçŸ©é˜µï¼ˆtool-auth-matrix.tsxï¼‰

- è¡¨æ ¼ï¼šè¡Œ = 8 ä¸ª Agent è§’è‰²ï¼Œåˆ— = å·¥å…·åˆ†ç±»ï¼ˆ6-8 ç±»ï¼‰
- å•å…ƒæ ¼ï¼šå¼€å…³ï¼ˆSwitchï¼‰
- è¡Œé¦–ï¼šå…¨é€‰è¡ŒæŒ‰é’®ï¼›åˆ—é¦–ï¼šå…¨é€‰åˆ—æŒ‰é’®
- æ”¯æŒæ‰¹é‡æ“ä½œï¼šé€‰ä¸­å¤šè¡Œ â†’ æ‰¹é‡æˆæƒ/æ’¤é”€

### 12.9 å·¥å…·æ³¨å†Œè¡¨é¡µï¼ˆagents/tools/page.tsxï¼‰

- é¡µé¢æ ‡é¢˜ + ç»Ÿè®¡ï¼ˆæ€»å·¥å…·æ•° / æœ¬åœ°å·¥å…·æ•° / äº‘ç«¯å·¥å…·æ•°ï¼‰
- æŒ‰åˆ†ç±»åˆ†ç»„å±•ç¤ºï¼ˆAccordionï¼‰
- æ¯ä¸ªå·¥å…·å¡ç‰‡ï¼šåç§° + æè¿° + é£é™©ç­‰çº§ + å¹³å°æ”¯æŒå›¾æ ‡ + å½“å‰å®¡æ‰¹ç­–ç•¥
- é¡¶éƒ¨æœç´¢ + é£é™©ç­‰çº§ç­›é€‰

---

## ä¸ƒã€MSW Mock æ‰©å±•

åœ¨ç°æœ‰ `mocks/handlers/agents.ts` åŸºç¡€ä¸Šè¡¥å……ï¼š

```
GET  /api/workspaces/:wsId/tools          # å·¥å…·æ³¨å†Œè¡¨åˆ—è¡¨
GET  /api/workspaces/:wsId/tool-auth      # æˆæƒçŸ©é˜µçŠ¶æ€
POST /api/workspaces/:wsId/tool-auth      # æ‰¹é‡æ›´æ–°æˆæƒ
GET  /api/workspaces/:wsId/knowledge-bases # çŸ¥è¯†åº“åˆ—è¡¨
```

æ–°å¢ Mock Factoryï¼š
- `tool.factory.ts`ï¼šç”Ÿæˆå·¥å…·åˆ—è¡¨ï¼ˆè¦†ç›–å„åˆ†ç±»ï¼‰
- `knowledge-base.factory.ts`ï¼šç”ŸæˆçŸ¥è¯†åº“åˆ—è¡¨

---

## å…«ã€å®ç°é¡ºåºå»ºè®®

1. ç±»å‹æ‰©å±• + Mock æ•°æ®è¡¥å……ï¼ˆAgent æ–°å­—æ®µã€Toolã€KnowledgeBaseï¼‰
2. `use-agents.ts` CRUD Hooks
3. `agent-card.tsx` + `agents/page.tsx`ï¼ˆåˆ—è¡¨å¯å…ˆçœ‹åˆ°æ•ˆæœï¼‰
4. `prompt-editor.tsx` + `tool-selector.tsx`ï¼ˆå¤ç”¨ç»„ä»¶å…ˆåšï¼‰
5. `agent-create-wizard.tsx`ï¼ˆä¾èµ–æ­¥éª¤ 4ï¼‰
6. `agent-config-drawer.tsx`ï¼ˆä¾èµ–æ­¥éª¤ 4ï¼‰
7. `tool-auth-matrix.tsx`
8. `agents/tools/page.tsx`

---

## ä¹ã€éªŒæ”¶æ ‡å‡†

| ä»»åŠ¡ | éªŒæ”¶æ ‡å‡† |
|------|---------|
| 12.1 | å¡ç‰‡ç½‘æ ¼æ­£å¸¸å±•ç¤ºã€çŠ¶æ€ç­›é€‰ã€æœç´¢è¿‡æ»¤ç”Ÿæ•ˆ |
| 12.2 | è§’è‰²è‰²å¸¦ã€çŠ¶æ€å¾½ç« ã€æ¨¡å‹æ ‡ç­¾æ­£ç¡®æ¸²æŸ“ |
| 12.3 | 4æ­¥å‘å¯¼æµç¨‹å®Œæ•´ï¼Œå¯æˆåŠŸåˆ›å»º Agent |
| 12.4 | æŠ½å±‰æ»‘å…¥æ»‘å‡ºï¼ŒTab åˆ‡æ¢ï¼Œä¿å­˜ç”Ÿæ•ˆ |
| 12.5 | Token è®¡æ•°å®æ—¶æ›´æ–°ï¼Œæ¨¡æ¿é€‰æ‹©å¡«å……å†…å®¹ |
| 12.6 | å·¥å…·åˆ†ç±»ã€æœç´¢ã€é£é™©ç­‰çº§æ ‡ç­¾ã€å¤šé€‰æ­£å¸¸ |
| 12.7 | CRUD æ“ä½œé€šè¿‡ MSW mock æ­£å¸¸å“åº” |
| 12.8 | çŸ©é˜µè¡¨æ ¼æ¸²æŸ“ï¼Œè¡Œåˆ—å…¨é€‰ï¼Œæ‰¹é‡æˆæƒç”Ÿæ•ˆ |
| 12.9 | å·¥å…·æŒ‰åˆ†ç±»åˆ†ç»„å±•ç¤ºï¼Œæœç´¢ç­›é€‰æ­£å¸¸ |
